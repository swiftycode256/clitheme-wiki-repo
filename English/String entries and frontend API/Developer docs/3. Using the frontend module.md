# Using the frontend module

The frontend module can fetch string entries in the current theme data. It also has other features like [using local definition files](Using%20local%20theme%20definition%20files).

> [!NOTE]
> The frontend module only supports Python 3. For other programming languages, you'll need to [directly access the data structure](1.%20Path%20names%20and%20data%20structure).

## The `FetchDescriptor` class

The frontend module primarily consists of the `FetchDescriptor` class, which has the ability to fetch string entries. You can specify fields like domain name, app name, and subsections. They will be automatically added to the entry path when fetching string entries.

Import the frontend module and create a `FetchDescriptor` instance:

```py
from clitheme import frontend

f = frontend.FetchDescriptor(
    domain_name="com.example",
    app_name="example-app",
    subsections="example-subsection subsection-2"
    lang="en_US" 
    debug_mode=False,
    disable_lang=False)
```

`FetchDescriptor` supports the following arguments:

- `domain_name`, `app_name`, `subsections`: They will be automatically added to entry paths
- `lang`: Override the automatically detected [system locale](../../[Appendix]%20Common%20syntax%20of%20theme%20definition%20files/Locale%20support) and use the specified locales
    - You can specify multiple space-separated locales (e.g. `en_US zh_CN`); string entries of these locales will be searched in this order
- `debug_mode`: If `True`, output additional debug messages
- `disable_lang`: If `True`, disable locale detection and always use the `default` entry for all string entries

You can also modify these settings after creating the `FetchDescriptor`, such as:

```py
f.debug_mode=True
f.disable_lang=True
```

### `retrieve_entry_or_fallback` function

To retrieve a string entry in the current theme data, use the `retrieve_entry_or_fallback` or `reof` function and provide the entry path and fallback string if not found. By default, it will use the system locale and fetch locale-specific version of string entries, unless `lang` or `disable_lang` is set.

```py
f = frontend.FetchDescriptor(
    domain_name="com.example",
    app_name="example-app",
    subsections="example-subsection subsection-2"
)
# Corresponds to com.example example-app example-subsection subsection-2 example-entry
f.retrieve_entry_or_fallback("example-entry", "Default text goes here")

# You can also use the reof function (same function)
f.reof("example-entry", "Default text goes here")

# Same as above function calls
f2=frontend.FetchDescriptor()
f2.reof("com.example example-app example-subsection subsection-2 example-entry", "Default text goes here")
```

## `format_entry_or_fallback` function

If the string needs to be formatted with `str.format`, you can use `format_entry_or_fallback` or `feof` function. It will handle formatting exceptions due to a malformed string entry to avoid errors. If the string entry is not found or a formatting error occurs, the fallback string is used.

Provide the path name, fallback string, and `str.format` arguments for this function.

```py
# Fallback string returns: "program: Current value is 1"
f.format_entry_or_fallback("example-fmt-entry", "{0}: Current value is {value}", "program", value="1")

# Equivalent to, but handles formatting errors for string entry:
f.reof("example-fmt-entry", "{0}: Current value is {value}").format("program", value="1")
```

## Setting arguments globally

You can set default argument values for all `FetchDescriptor` instances. The following functions only persists settings **in this file only**. You can use `None` to unset default values.

- `set_domain`
- `set_appname`
- `set_subsections`
- `set_debugmode`
- `set_lang`
- `set_disablelang`

> [!NOTE]
> `FetchDescriptor` instances created before setting the default values are not affected. 

You can also set the following global variables, which applies to all files within a module, and is used only if defaults not set using the above functions.

- `global_domain`
- `global_appname`
- `global_subsections`
- `global_debugmode`
- `global_lang`
- `global_disablelang`

```py
from clitheme import frontend

f0=frontend.FetchDescriptor() # Won't use any default values

# Set default values
frontend.set_domain("com.example")
frontend.set_appname("example-app")
frontend.set_subsections("example-subsection subsection-2")
frontend.set_debugmode(False)
frontend.set_lang("")
frontend.set_disablelang(False)

# Uses default values
f1=frontend.FetchDescriptor() 
f2=frontend.FetchDescriptor()

# debug_mode=True overrides the setting in default values
f3=frontend.FetchDescriptor(debug_mode=True) 

# Fallback defaults
frontend.global_domain=""
frontend.global_appname=""
frontend.global_subsections=""
frontend.global_debugmode=False
frontend.global_lang=""
frontend.global_disablelang=False
```

## Using the fallback module

You can embed the fallback module provided in the repository when CLItheme is not installed. This fallback module provides all functions in the frontend module, and always return fallback values.

Include the `frontend_fallback.py` file from the repository and use the following code:

```py
try:
    from clitheme import frontend
except:
    import frontend_fallback as frontend
```

## Demo

For a demo of the frontend module, refer to the `frontend-demo` directory in the project repository.